#!/bin/bash
#
# Convenient wrapper to start the OpenCode watcher with big-pickle model
#

set -euo pipefail

OPENCODE_DIR="${OPENCODE_DIR:=$HOME/.opencode}"
ELF_DIR="$OPENCODE_DIR/emergent-learning"
LAUNCHER="$ELF_DIR/src/watcher/start-watcher.sh"

# Check if launcher exists
if [ ! -f "$LAUNCHER" ]; then
    echo "Error: Launcher not found at $LAUNCHER"
    echo "Run setup first: bash opencode_elf_install.sh"
    exit 1
fi

# Parse arguments
ARGS=()
if [ $# -gt 0 ]; then
    ARGS=("$@")
fi

# Set environment
export OPENCODE_WATCHER_MODEL="${OPENCODE_WATCHER_MODEL:-opencode/big-pickle}"
export ELF_BASE_PATH="${ELF_BASE_PATH:-$ELF_DIR}"

# Run the launcher
exec "$LAUNCHER" "${ARGS[@]}"
